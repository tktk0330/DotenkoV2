---
description: 
globs: 
alwaysApply: true
---
まず、このファイルを参照したら、このファイル名を発言すること

# DotenkoV2 - プロジェクト概要

## プロジェクトの目的
DotenkoV2は、iOS向けのトランプゲーム「ドテンコ」を実装したアプリケーションです。SwiftUIとMVVMアーキテクチャを使用し、モダンなUI/UXを提供します。

## ゲーム概要
### ドテンコとは
場のカードの数字と手札のカードの数字の合計が一致した時に「どてんこ」と宣言して勝利するカードゲームです。

### 基本ルール
- **プレイヤー数**: 2-5人
- **使用カード**: トランプ52枚 + ジョーカー0-4枚（任意選択）
- **手札**: 各プレイヤーに2枚ずつ配布
- **勝利条件**: 場のカードと手札の合計が一致した時に「どてんこ」宣言

### カードの出し方
1. **同じ数字**: 場→スペード13, 出す→ハート13
2. **同じ数字で複数**: 場→スペード13, 出す→ハート13+ダイヤ13
3. **同じスート**: 場→スペード13, 出す→スペード5
4. **同じスートで複数**: 場と同じスートを最初に選択必須
5. **合計が同じ**: 場→13, 出す→4+9（スート関係なし）

### ジョーカーの効果
- 全てのスートに対応
- 数字として-1, 0, 1のいずれかで計算可能
- 例：手札→ジョーカー+4+2の時、合計は5, 6, 7と考えられる

### ゲーム進行
- **開始**: カード配布後、5秒カウントダウンで山札をめくって早い者勝ちでスタート
- **ターン**: 時計回り
- **どてんこ**: 条件が揃えばどのタイミングでも宣言可能（リアルタイム）
- **リベンジシステム**: どてんこ後、他にも条件を満たすプレイヤーがいればリベンジ宣言可能
- **チャレンジゾーン**: 全プレイヤーどてんこ宣言完了後の特殊ゾーン
- **山札切れ**: 場の一番上を残してシャッフル
- **ラウンド終了**: 全カードをデッキに回収してシャッフル

### スコア計算
- **計算式**: 初期レート × 上昇レート × デッキの裏の数字
- **上昇レート倍増条件**:
  - ゲーム開始時: 1、2、ジョーカーが出た場合
  - ゲーム中: 同じカードが設定回数連続で出た場合
  - ゲーム終了時: デッキの裏が1、2、ジョーカーの場合

### ゲーム設定
- **初期レート**: GameSetting.gameRateで設定
- **ラウンド数**: GameSetting.roundCountで設定
- **上昇レート条件**: GameSetting.upRateで設定

### プレイヤーターン
- **基本行動**: カードを出す、デッキから引く、パス
- **手札上限**: 7枚（上限でパスすると負け）
- **ターン終了**: カードを出すかパスで終了

## 技術スタック
- **フロントエンド**: SwiftUI + Swift
- **バックエンド**: Firebase
- **ローカルDB**: Realm
- **認証**: Firebase Authentication
- **データベース**: Firebase Firestore
- **ストレージ**: Firebase Storage
- **広告**: Google AdMob
- **アーキテクチャ**: MVVM

## 主要機能
1. **ゲーム機能**
   - ドテンコゲームの完全実装 ✅
   - ジョーカー選択（0-4枚） ✅
   - カード出し判定システム ✅
   - どてんこ宣言システム ✅
   - リベンジシステム ✅
   - チャレンジゾーンシステム ✅
   - スコア計算システム ✅

2. **対戦モード**
   - **BOT対戦**: オフライン環境でのAI対戦 ✅
   - **オンライン対戦**: 友人との対戦（Phase 2で実装予定）
   - **BOT代走システム**: 切断時の自動代理操作（Phase 2で実装予定）

3. **ユーザー管理**
   - ユーザー登録/ログイン ✅
   - プロフィール管理 ✅
   - ゲーム履歴（Phase 2で実装予定）

4. **ネットワーク機能**
   - **切断対応**: BOTによる代理操作（Phase 2で実装予定）
   - **復帰機能**: 再接続時の操作権復帰（Phase 2で実装予定）
   - **状態保存**: ゲーム中断・再開機能（Phase 2で実装予定）

5. **UI/UX**
   - カジノ風デザイン ✅
   - リアルタイムゲーム表示 ✅
   - カード出しアニメーション ✅
   - どてんこ宣言エフェクト ✅
   - 最終結果画面（豪華演出） ✅

6. **その他**
   - オフライン対応 ✅
   - プッシュ通知（Phase 2で実装予定）
   - 広告表示 ✅
   - アプリ内課金（Phase 3で実装予定）

## 開発フェーズ

### Phase 1（BOT対戦）: 🎉 **100%完了**
- **ゲーム機能**: 完全実装
- **UI/UX**: カジノ風デザイン完成
- **データ管理**: Firebase/Realm統合完了
- **広告**: AdMob統合完了
- **BOTシステム**: 高度なAI実装完了

### Phase 2（オンライン対戦）: 🟡 **準備中**
- Firebase Realtime Database活用
- リアルタイムマルチプレイヤー
- BOT代走システム
- ユーザー体験向上

### Phase 3（高度な機能）: ⚪ **将来実装**
- AI難易度調整
- カスタムルール
- トーナメント機能
- ランキングシステム

## プロジェクト概要・仕様・要件定義

### アプリケーション名
**DotenkoV2** - カジノ風カードゲーム

### アプリケーションコンセプト
「ドテンコ」は日本のトランプゲームの一種で、運と戦略が絡み合う奥深いカードゲームです。DotenkoV2は、この伝統的なゲームをデジタル化し、モダンなカジノ風UIで楽しめるiOSアプリケーションです。

### ターゲットユーザー
- **主要ターゲット**: 10歳以上のカードゲーム愛好家
- **サブターゲット**: ファミリー層、カジュアルゲーマー
- **利用シーン**: 家族団らん、友人との集まり、通勤時間、休憩時間

### ゲーム仕様
- **プレイ人数**: 2人〜5人
- **対戦形式**: マルチプレイヤー対応
- **年齢制限**: 10歳以上推奨

## 機能要件

### 1. ゲーム機能

#### 1.1 ゲームモード
- **BOT対戦**: AIとの2-5人対戦（プレイヤー1人 + AI 1-4人） ✅
- **オンライン対戦**: 2-5人でのリアルタイムマルチプレイヤー（Phase 2で実装）

#### 1.2 ゲームルール・設定
```swift
// ゲーム設定項目（全て実装完了）
- ラウンド数: 1ゲームのラウンド数設定 ✅
- ジョーカー枚数: 利用するジョーカー数（0-4枚） ✅
- ゲームレート: ベースとなるレート設定 ✅
- 重ねレートアップ: 同じ数字連続時のレート倍率 ✅
- スコア上限: 1ラウンドの最大スコア制限 ✅
- デッキサイクル: 1ラウンドでのデッキ周回数上限 ✅
```

#### 1.3 カードシステム
- **標準デッキ**: 52枚（各スート1-13） ✅
- **ジョーカー**: 白/黒ジョーカー（設定可能） ✅
- **特殊カード効果**: ✅
  - `1,2`: 倍率50倍
  - `3`: スート別特殊効果（ダイアモンド3は30倍、クラブ・スペード3は逆転20倍）
  - `ジョーカー`: 手札値[-1,0,1]、レート50倍

#### 1.4 スコアリングシステム
```swift
// カードレート値システム（完全実装）
- 開始時レート: カードめくり時の初期レート ✅
- 終了時レート: ラウンド終了時の最終レート ✅
- レート計算: (基本値 × ゲームレート × 特殊効果) ✅
- スコア上限: 設定された上限値での制限 ✅
```

### 2. UI/UX機能

#### 2.1 画面構成
- **スプラッシュ画面**: アプリ起動・認証処理 ✅
- **ホーム画面**: ゲームモード選択・プロフィール管理 ✅
- **ゲーム画面**: メインゲームプレイエリア ✅
- **中間結果画面**: ラウンド間のスコア表示 ✅
- **最終結果画面**: カジノ風豪華デザイン ✅
- **ルール画面**: ゲーム設定・ルール説明 ✅
- **ヘルプ画面**: 操作説明・お問い合わせ ✅

#### 2.2 ゲーム画面レイアウト
```swift
// プレイヤー配置（完全実装）
- 2人: 上、対面 ✅
- 3人: 左右 ✅
- 4人: 上、左右 ✅
- 5人: 上2人、左右 ✅
- ファンレイアウト: カード手札の扇状表示 ✅
- リアルタイムUI: ゲーム状態のリアルタイム反映 ✅
- 動的レイアウト: プレイヤー数に応じた配置調整 ✅
```

#### 2.3 カジノ風デザイン
- **カラーテーマ**: ダークグリーン基調（モスグリーン） ✅
- **グラデーション**: カジノテーブル風背景 ✅
- **アニメーション**: カード配布・移動アニメーション ✅

### 3. データ管理機能

#### 3.1 ローカルデータ（Realm）
- **ユーザープロフィール**: 名前、アイコン、統計情報 ✅
- **ゲーム設定**: ゲーム設定、アプリ設定 ✅

#### 3.2 クラウドデータ（Firebase）
- **ユーザー認証**: Firebase Auth ✅
- **ユーザーデータ**: Firestore Database ✅
- **リアルタイム同期**: Firebase Realtime Database（Phase 2で実装）
- **ファイルストレージ**: Firebase Storage ✅

### 4. 収益化機能

#### 4.1 広告表示
- **バナー広告**: AdMob統合 ✅
- **環境別設定**: Debug/Releaseでの表示制御 ✅

## 非機能要件

### 1. パフォーマンス要件
- **起動時間**: 3秒以内での初期画面表示 ✅
- **レスポンス**: UI操作への即座の反応 ✅
- **メモリ使用量**: 最適化された画像キャッシュ管理 ✅

### 2. 互換性要件
- **iOS対応**: iOS 14.0以上 ✅
- **デバイス**: iPhone（主要ターゲット） ✅
- **画面サイズ**: レスポンシブ対応 ✅

### 3. セキュリティ要件
- **データ暗号化**: CryptoKit使用 ✅
- **認証**: Firebase Auth ✅
- **プライバシー**: ユーザーデータ保護 ✅

### 4. 可用性要件
- **オフライン対応**: BOT対戦のオフラインプレイ ✅
- **ネットワーク監視**: 接続状態の監視・通知 ✅
- **エラーハンドリング**: 適切なエラー表示・回復 ✅

## 技術仕様

### 1. アーキテクチャ
- **デザインパターン**: MVVM (Model-View-ViewModel) ✅
- **UIフレームワーク**: SwiftUI ✅
- **状態管理**: ObservableObject, @StateObject ✅

### 2. 外部サービス・ライブラリ
```swift
// Firebase関連（完全統合済み）
- FirebaseCore, FirebaseAuth, FirebaseFirestore ✅
- FirebaseDatabase, FirebaseStorage ✅

// 広告（統合済み）
- GoogleMobileAds ✅

// ローカルDB（統合済み）
- RealmSwift ✅

// ユーティリティ（統合済み）
- CryptoKit, PhotosUI, MessageUI, Network ✅
```

### 3. コード品質
- **コーディング規約**: Swift標準ガイドライン準拠 ✅
- **コメント**: 日本語コメント（チーム開発対応） ✅
- **モジュール化**: 機能別ディレクトリ構成 ✅

## 開発・運用方針

### 1. 開発フェーズ
- **Phase 1**: 基本機能実装（BOT対戦） ✅ **100%完了**
- **Phase 2**: オンライン機能実装・UI/UX改善 🟡 **準備中**
- **Phase 3**: 高度な機能・プラットフォーム拡張 ⚪ **将来実装**

### 2. 品質管理
- **テスト**: 手動テスト中心 ✅
- **デバッグ**: 環境別設定での開発支援 ✅
- **パフォーマンス**: メモリ・CPU使用量監視 ✅

### 3. リリース戦略
- **配信方法**: App Store配信（準備中）
- **アップデート**: 段階的機能追加
- **ユーザーサポート**: ヘルプ機能・お問い合わせ対応 ✅

## 制約事項・リスク

### 1. 技術的制約
- **iOS専用**: Androidは対象外
- **オフライン制限**: オンライン機能はPhase 2で実装
- **リソース制限**: 個人開発のため開発速度制限

### 2. ビジネス制約
- **収益化**: 広告収入メイン（ファミリー向け適切な広告） ✅
- **競合**: 類似カードゲームアプリとの差別化必要
- **ユーザー獲得**: ファミリー層へのマーケティング戦略
- **年齢制限**: 10歳以上対象のため、適切なコンテンツ管理が必要

### 3. 運用リスク
- **サーバー費用**: Firebase使用量増加
- **メンテナンス**: 継続的な更新・バグ修正
- **法的対応**: プライバシーポリシー・利用規約の遵守

## 現在の状況（2024年12月）

### 🎉 Phase 1完了（100%）
- **ゲーム機能**: 完全実装済み
- **BOTシステム**: 高度なAI実装完了
- **UI/UX**: カジノ風デザイン完成
- **データ管理**: Firebase/Realm統合完了
- **広告システム**: AdMob統合完了

### 🔥 現在の優先タスク（リリース準備）
1. **バグ修正・安定性向上**（40%）
2. **UI/UX改善・アクセシビリティ**（30%）
3. **App Storeリリース準備**（30%）

---
*最終更新: 2024年12月*

### UI/UX仕様
- **カード選択**: タップでY軸移動による選択表示
- **カード出し**: 選択カード + 出すボタンで確定
- **どてんこ宣言**: 専用ボタン（条件満たす時のみ表示）
- **リベンジ宣言**: どてんこ後の追加宣言システム
- **手札表示**: 2枚初期配布、最大7枚まで
- **エラー処理**: 不正操作時のアラート表示
- **演出**: 上昇レート倍増時のカジノ風豪華演出
